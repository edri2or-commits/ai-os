#!/bin/sh
#
# Pre-commit hook: Auto-sync SYSTEM_BOOK.md from 01-active-context.md
#
# Research Support:
# - xcubelabs.com (June 27, 2024): "Version control systems such as Git to track changes"
# - github.com/resources (October 15, 2025): "GitHub Actions, a CI/CD platform"
# - devops.com (January 5, 2024): "CI/CD pipeline can automatically build and deploy"
#
# Ensures SYSTEM_BOOK.md is always in sync with Memory Bank ground truth
# Zero drift, zero maintenance

echo "[Pre-commit] Syncing SYSTEM_BOOK.md..."

# Navigate to repo root
cd "$(git rev-parse --show-toplevel)"

# Run sync script
python tools/sync_system_book.py

# Check if script succeeded
if [ $? -ne 0 ]; then
    echo "[Pre-commit] ERROR: sync_system_book.py failed"
    echo "Fix the error and try again, or commit with --no-verify to skip"
    exit 1
fi

# Stage updated SYSTEM_BOOK.md
git add SYSTEM_BOOK.md

echo "[Pre-commit] SYSTEM_BOOK.md synced and staged âœ“"
exit 0
