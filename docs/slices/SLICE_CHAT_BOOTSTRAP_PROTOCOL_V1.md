# SLICE_CHAT_BOOTSTRAP_PROTOCOL_V1

**Date:** 2025-11-28  
**Phase:** 2.3 (INFRA_ONLY)  
**Status:** ‚úÖ COMPLETE  
**Type:** Protocol & Templates (Infrastructure)

---

## üéØ Goal

Transform Chat Bootstrap from **informal prose** ‚Üí **formal, consistent protocol** that every new chat session (Claude, GPT, etc.) can follow to properly initialize with AI-OS context.

**Before This Slice:**
- Bootstrap instructions scattered across multiple docs
- Inconsistent handshake responses
- Agents relying on chat memory instead of Truth Layer
- No standard format for verification

**After This Slice:**
- Single source of truth: `CHAT_BOOTSTRAP_PROTOCOL_V1`
- Standardized handshake format (`ACK_CONTEXT_LOADED + SUMMARY + ...`)
- Clear Truth Sources list (COMPACT, GOVERNANCE, TIMELINE)
- Template for bootstrap prompt
- Template for session manifest (future auto-generation)

---

## üìÅ Files Created/Modified

### Created (5 files)

1. **`docs/protocols/`** (NEW directory)
   - Protocols directory for formal procedures

2. **`docs/protocols/CHAT_BOOTSTRAP_PROTOCOL_V1.md`** (~400 lines)
   - **THE** bootstrap protocol specification
   - Truth Sources (COMPACT, GOVERNANCE, TIMELINE)
   - 5-step bootstrap flow
   - Handshake contract (mandatory format)
   - Failure modes
   - Examples (good & bad handshakes)

3. **`docs/protocols/CHAT_BOOTSTRAP_PROMPT_TEMPLATE_V1.md`** (~100 lines)
   - Ready-to-paste prompt for new chat sessions
   - Instructions for Or
   - Expected response format
   - Re-bootstrap instructions

4. **`docs/session/`** (NEW directory)
   - Session-related files and manifests

5. **`docs/session/SESSION_MANIFEST_TEMPLATE_V1.json`** (~150 lines)
   - Template showing what a session manifest should contain
   - Agent role, system state, capabilities, constraints
   - Truth sources with timestamps
   - Recent work, fitness focus
   - V1: Internal only (not auto-generated yet)
   - V2: Will be auto-generated by script

6. **`docs/slices/SLICE_CHAT_BOOTSTRAP_PROTOCOL_V1.md`** (this file)
   - Slice documentation

### Modified (1 file)

7. **`docs/system_state/timeline/EVENT_TIMELINE.jsonl`** (append)
   - Added SLICE_COMPLETE event for this slice

---

## üîÑ Bootstrap Flow (Summary)

```
New Chat Session
    ‚Üì
Step 1: Load SYSTEM_STATE_COMPACT.json
    ‚Üì Extract: phase, mode, services, recent_work, fitness
    ‚Üì
Step 2: Load GOVERNANCE_LATEST.json
    ‚Üì Cross-verify: phase, mode, fitness metrics
    ‚Üì
Step 3: Load EVENT_TIMELINE.jsonl (tail -20)
    ‚Üì Extract: recent slices, errors, events
    ‚Üì
Step 4: Assemble SESSION_MANIFEST (internal)
    ‚Üì Combine: capabilities, constraints, focus
    ‚Üì
Step 5: Produce HANDSHAKE Response
    ‚Üì Format: ACK_CONTEXT_LOADED + SUMMARY + ...
    ‚Üì
Chat Ready for Work
```

---

## ‚úÖ Handshake Format (Required)

Every bootstrapped chat **MUST** respond with:

```
ACK_CONTEXT_LOADED

SUMMARY:
- Phase: <phase>
- Mode: <mode>
- Role: <role>
- Truth Sources Loaded: <list with timestamps>

CAPABILITIES:
- Read: <what can read>
- Write: <what can write via contracts>
- Blocked: <what cannot do>

HARD CONSTRAINTS:
- INFRA_ONLY: <explanation>
- Truth Protocol: <explanation>
- <other constraints>

CURRENT FOCUS:
- <2-3 items>

RECENT WORK:
- <last 3-5 slices>

READY FOR INSTRUCTIONS.
```

**Mandatory Elements:**
- `ACK_CONTEXT_LOADED` (first line)
- All sections (SUMMARY, CAPABILITIES, HARD CONSTRAINTS, etc.)
- Truth source timestamps
- `READY FOR INSTRUCTIONS.` (last line)

---

## üß™ Testing / Manual Validation

### Test 1: Use Bootstrap Prompt

1. Open new chat session (Claude/GPT)
2. Paste prompt from `CHAT_BOOTSTRAP_PROMPT_TEMPLATE_V1.md`
3. Verify response includes:
   - ‚úÖ `ACK_CONTEXT_LOADED`
   - ‚úÖ Phase: "Phase 2.3 ‚Äì Stabilizing the Hands"
   - ‚úÖ Mode: "INFRA_ONLY"
   - ‚úÖ Truth sources with timestamps
   - ‚úÖ Hard constraints listed
   - ‚úÖ `READY FOR INSTRUCTIONS.`

### Test 2: Verify Truth Sources

Agent should show:
```
Truth Sources Loaded:
- SYSTEM_STATE_COMPACT (v1.2, 2025-11-27T22:40:00Z)
- GOVERNANCE_LATEST (2025-11-27T20:26:48Z)
- EVENT_TIMELINE (last 20 events)
```

### Test 3: Check Constraints

Agent should NOT claim:
- ‚ùå "I can send emails"
- ‚ùå "I can create calendar events"
- ‚ùå "I can access your Gmail"

Agent SHOULD say:
- ‚úÖ "INFRA_ONLY - no real-world service actions"
- ‚úÖ "Truth Protocol - file-based state only"
- ‚úÖ "PR_CONTRACT_V1 for infrastructure changes"

### Test 4: Re-Bootstrap

If agent gives invalid response:
1. Say: "Please re-run Chat Bootstrap Protocol V1"
2. Agent should restart from Step 1
3. Verify correct handshake this time

---

## üìä Impact on System

### Truth Layer (No Changes)

Bootstrap is **read-only** - doesn't modify Truth Layer files.

### Documentation

**New Protocols Directory:**
- `docs/protocols/` - formal procedures
- First protocol: `CHAT_BOOTSTRAP_PROTOCOL_V1.md`

**New Session Directory:**
- `docs/session/` - session-related templates
- First template: `SESSION_MANIFEST_TEMPLATE_V1.json`

**Relationship to Existing Docs:**

| Old Doc | Status | Relationship |
|---------|--------|--------------|
| `docs/AGENT_INIT_INSTRUCTIONS.md` | Legacy | Superseded but kept for reference |
| `docs/SESSION_INIT_CHECKLIST.md` | Outdated (Phase 2.2) | Replaced for Phase 2.3+ |
| `docs/CUSTOM_GPT_OPERATOR_SPEC.md` | Active | Complements (role-specific) |

---

## ‚ö†Ô∏è Known Limitations (V1)

### What V1 Does NOT Include:

‚ùå **Auto-Generated Manifests**
- V1: Agents assemble manifest internally during bootstrap
- V2: Script `generate_session_manifest.py` auto-creates JSON file

‚ùå **Bootstrap Validation**
- V1: Manual verification by Or
- V2: Script `validate_bootstrap_response.py` checks handshake

‚ùå **Session ID Tracking**
- V1: No session IDs
- V2: Generate unique session IDs, track across chat instances

‚ùå **Multi-Agent Coordination**
- V1: Each chat bootstraps independently
- V2: Shared manifest, conflict detection

‚ùå **Capability Auto-Discovery**
- V1: Hardcoded capabilities in template
- V2: Scan contracts directory, detect available operations

‚ùå **n8n Integration**
- V1: Manual bootstrap
- V2: Workflow `BOOTSTRAP_VALIDATOR_V1` validates on session start

‚ùå **Manifest Persistence**
- V1: Internal only, not saved to file
- V2: Save to `docs/session/manifests/SESSION_{id}.json`

---

## üîÆ Next Steps (V2+)

### Immediate Improvements

1. **Auto-Generate Manifest:**
   ```bash
   python scripts/generate_session_manifest.py
   # Output: docs/session/SESSION_MANIFEST_CURRENT.json
   ```

2. **Bootstrap Validator:**
   ```bash
   python scripts/validate_bootstrap_response.py response.txt
   # Output: PASS/FAIL + reasons
   ```

3. **Session IDs:**
   - Format: `session-{timestamp}-{random}`
   - Track in `docs/session/active_sessions.json`

### Future Enhancements

4. **n8n Workflow:**
   - `BOOTSTRAP_VALIDATOR_V1`
   - Trigger: Webhook on new chat
   - Validate handshake automatically

5. **Capability Discovery:**
   - Scan `docs/sync_contracts/` for available contracts
   - Auto-populate capabilities in manifest

6. **Multi-Agent Support:**
   - Shared manifest across concurrent chats
   - Conflict detection and resolution

---

## üìù Usage Example

### For Or (Starting New Chat):

1. Open new Claude/GPT chat
2. Go to `docs/protocols/CHAT_BOOTSTRAP_PROMPT_TEMPLATE_V1.md`
3. Copy the bootstrap prompt (between the code fences)
4. Paste into new chat
5. Wait for handshake response
6. Verify:
   - Starts with `ACK_CONTEXT_LOADED`
   - Includes all required sections
   - Lists correct phase/mode/constraints
   - Ends with `READY FOR INSTRUCTIONS.`
7. If valid ‚Üí Proceed with work
8. If invalid ‚Üí Say "Please re-run Chat Bootstrap Protocol V1"

### For Agent (Internal Flow):

```python
# Conceptual pseudocode (not actual implementation)

def bootstrap():
    # Step 1: Load COMPACT
    compact = read_json("docs/system_state/SYSTEM_STATE_COMPACT.json")
    phase = compact["system"]["phase"]
    mode = compact["system"]["mode"]
    recent_work = compact["recent_work"][:5]
    
    # Step 2: Load GOVERNANCE
    governance = read_json("governance/snapshots/GOVERNANCE_LATEST.json")
    fitness = governance["fitness_metrics"]
    
    # Step 3: Load TIMELINE
    timeline = read_jsonl_tail("docs/system_state/timeline/EVENT_TIMELINE.jsonl", 20)
    
    # Step 4: Assemble Manifest (internal)
    manifest = {
        "phase": phase,
        "mode": mode,
        "capabilities": {"read": [...], "write_contracts": ["PR_CONTRACT_V1"]},
        "hard_constraints": ["INFRA_ONLY", "Truth Protocol", "PR workflow"]
    }
    
    # Step 5: Produce Handshake
    print("ACK_CONTEXT_LOADED")
    print("\nSUMMARY:")
    print(f"- Phase: {phase}")
    print(f"- Mode: {mode}")
    # ... etc
    print("\nREADY FOR INSTRUCTIONS.")
```

---

## üéØ Success Criteria

‚úÖ **Protocol Documentation Complete**
- CHAT_BOOTSTRAP_PROTOCOL_V1.md covers all steps

‚úÖ **Templates Created**
- SESSION_MANIFEST_TEMPLATE_V1.json shows manifest structure
- CHAT_BOOTSTRAP_PROMPT_TEMPLATE_V1.md ready for use

‚úÖ **Clear Truth Sources**
- COMPACT, GOVERNANCE, TIMELINE explicitly listed

‚úÖ **Standardized Handshake**
- Format defined with mandatory fields

‚úÖ **Failure Modes Documented**
- Examples of good & bad handshakes

‚úÖ **Integration with Existing Docs**
- Relationship to legacy docs clarified

---

## üéì Key Learnings

### What Worked Well

‚úÖ **Single Protocol Doc**
- Clear, comprehensive, no ambiguity
- Examples make expectations concrete

‚úÖ **Template-Based Approach**
- Bootstrap prompt is copy-paste ready
- Manifest template shows structure clearly

‚úÖ **Truth Protocol Emphasis**
- Forces agents to read actual files, not assume from memory

‚úÖ **Hard Constraints First**
- INFRA_ONLY front and center
- No risk of agents claiming unavailable capabilities

### Challenges

‚ö†Ô∏è **No Auto-Validation**
- V1 relies on manual verification
- Easy for Or to miss invalid handshakes

‚ö†Ô∏è **Manifest Not Persisted**
- Internal only in V1
- Hard to audit what agent actually loaded

‚ö†Ô∏è **No Session Tracking**
- Can't tell which chats are properly bootstrapped
- No way to resume sessions

---

## üìö Related Documentation

- **Protocol:** `docs/protocols/CHAT_BOOTSTRAP_PROTOCOL_V1.md`
- **Prompt Template:** `docs/protocols/CHAT_BOOTSTRAP_PROMPT_TEMPLATE_V1.md`
- **Manifest Template:** `docs/session/SESSION_MANIFEST_TEMPLATE_V1.json`
- **Truth Sources:**
  - `docs/system_state/SYSTEM_STATE_COMPACT.json`
  - `governance/snapshots/GOVERNANCE_LATEST.json`
  - `docs/system_state/timeline/EVENT_TIMELINE.jsonl`

---

**Slice Completed:** 2025-11-28  
**Next Slice:** TBD (possibly Email Contract or Bootstrap Validator)  
**Status:** ‚úÖ COMPLETE  
**Pattern Established:** Formal Bootstrap Protocol for Chat Sessions
