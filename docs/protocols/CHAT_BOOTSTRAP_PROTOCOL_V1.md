# CHAT_BOOTSTRAP_PROTOCOL_V1

**Version:** 1.0  
**Date:** 2025-11-28  
**Phase:** 2.3 (INFRA_ONLY)  
**Status:** âœ… Active

---

## ğŸ¯ Purpose & Scope

This protocol defines the **standardized bootstrap procedure** for any chat session (Claude, GPT, or other LLM agents) working with AI-OS.

**Goals:**
1. **Consistent Truth Layer Access:** Every new chat loads the same Truth Sources
2. **Phase/Mode Awareness:** Agent understands current phase, mode, and constraints
3. **Capability Discovery:** Agent knows what it can/cannot do
4. **Predictable Handshake:** Standardized response format for verification

**Scope:**
- **Applies to:** All chat agents in Phase 2.3+ (INFRA_ONLY mode)
- **Not a replacement for:** Detailed agent instructions or role-specific guides
- **Complements:** SESSION_INIT_CHECKLIST, AGENT_INIT_INSTRUCTIONS (legacy docs)

---

## ğŸ“š Truth Sources (Required Reading)

Every new chat session **MUST** load these files in order:

### 1. Primary Truth Layer

| File | Purpose | Must Read |
|------|---------|-----------|
| `docs/system_state/SYSTEM_STATE_COMPACT.json` | Current state: phase, mode, services, recent work | âœ… YES |
| `governance/snapshots/GOVERNANCE_LATEST.json` | Fitness metrics, governance rules | âœ… YES |

### 2. Event Log (Recent Context)

| File | Purpose | Must Read |
|------|---------|-----------|
| `docs/system_state/timeline/EVENT_TIMELINE.jsonl` | Last 20-50 events for recent work context | âœ… YES (tail) |

### 3. Decision Log

| File | Purpose | Must Read |
|------|---------|-----------|
| `docs/DECISIONS_AI_OS.md` | All architectural decisions (DEC-xxx) | âš ï¸ Optional but recommended |

### 4. Legacy Bootstrap Docs (Reference Only)

| File | Purpose | Must Read |
|------|---------|-----------|
| `docs/AGENT_INIT_INSTRUCTIONS.md` | Original agent boot instructions (outdated) | â„¹ï¸ Reference only |
| `docs/SESSION_INIT_CHECKLIST.md` | Session init checklist (Phase 2.2, outdated) | â„¹ï¸ Reference only |

**Notes:**
- **SYSTEM_STATE_COMPACT is DERIVED STATE** - auto-generated by reconciler, do not edit manually
- **Truth priority:** If COMPACT conflicts with other docs, COMPACT wins (it's reconciled)
- **Always check `_generated` timestamp** in COMPACT to ensure freshness

---

## ğŸ”„ Bootstrap Steps (Mandatory Flow)

Every new chat session follows this flow:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: Load SYSTEM_STATE_COMPACT.json    â”‚
â”‚  â†’ Extract: phase, mode, services_summary  â”‚
â”‚  â†’ Extract: recent_work (last 5-10 items)  â”‚
â”‚  â†’ Extract: fitness_metrics                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: Load GOVERNANCE_LATEST.json       â”‚
â”‚  â†’ Cross-verify: phase, mode, fitness      â”‚
â”‚  â†’ Extract: snapshot_id, created_at        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3: Load EVENT_TIMELINE.jsonl (tail)  â”‚
â”‚  â†’ Read: Last 20-50 events                 â”‚
â”‚  â†’ Identify: Recent slices, errors         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 4: Assemble SESSION_MANIFEST         â”‚
â”‚  â†’ Combine: phase, mode, capabilities      â”‚
â”‚  â†’ Identify: hard constraints              â”‚
â”‚  â†’ Determine: available contracts          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 5: Produce HANDSHAKE Response        â”‚
â”‚  â†’ Format: ACK_CONTEXT_LOADED              â”‚
â”‚  â†’ Include: Summary + Constraints          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Detailed Steps

#### Step 1: Load SYSTEM_STATE_COMPACT.json

**Read fields:**
- `system.phase` - Current phase (e.g., "Phase 2.3 â€“ Stabilizing the Hands")
- `system.mode` - Current mode (e.g., "INFRA_ONLY")
- `system.automations_enabled` - Automation status (should be `false` in INFRA_ONLY)
- `services_summary` - Service health (up/partial/planned/broken)
- `recent_work` - Last 5-10 events/slices
- `fitness_metrics` - Current fitness scores
- `_generated` - Timestamp (ensure < 24h old)

**Validate:**
- File exists and is valid JSON
- `_schema` = "SYSTEM_STATE_COMPACT_V1" (or newer)
- Timestamp is recent (< 24 hours ideally)

#### Step 2: Load GOVERNANCE_LATEST.json

**Read fields:**
- `system_state.phase` - Cross-verify with COMPACT
- `system_state.mode` - Cross-verify with COMPACT
- `fitness_metrics` - Current metrics (FITNESS_001, FITNESS_002)
- `git.branch` - Verify on "main"
- `created_at` - Snapshot timestamp

**Validate:**
- Phase/mode match COMPACT
- Snapshot is recent

#### Step 3: Load EVENT_TIMELINE.jsonl (tail)

**Read:**
- Last 20-50 lines (use `tail -20` or similar)
- Parse as JSONL (one JSON per line)

**Extract:**
- Recent `SLICE_COMPLETE` events
- Recent `PR_CREATED` or `PR_INTENT_CREATED` events
- Any `ERROR` or `FAILED` events
- `STATE_RECONCILIATION` events

**Use for:**
- Understanding recent work
- Checking for active slices
- Identifying potential issues

#### Step 4: Assemble SESSION_MANIFEST (Internal)

**Combine information into internal manifest:**

```json
{
  "phase": "Phase 2.3 â€“ Stabilizing the Hands",
  "mode": "INFRA_ONLY",
  "automations_enabled": false,
  "capabilities": {
    "read": ["Truth Layer", "Docs", "Code"],
    "write_contracts": ["PR_CONTRACT_V1"],
    "no_direct_write": ["State files", "Gmail", "Calendar", "Tasks"]
  },
  "hard_constraints": [
    "INFRA_ONLY - no actions on Or's real-world services",
    "No direct state file edits (use reconciler or contracts)",
    "All changes via PR (using PR_CONTRACT_V1)",
    "Truth Protocol - rely on files, not memory"
  ],
  "fitness_focus": [
    "Stabilize Phase 2.3 Control Plane",
    "Reduce drift between docs and implementation",
    "Complete Write Contracts (Email, Calendar, Tasks)"
  ]
}
```

**Note:** V1 of this protocol doesn't persist the manifest to a file - it's internal only.

#### Step 5: Produce HANDSHAKE Response

**Format:**
```
ACK_CONTEXT_LOADED

SUMMARY:
- Phase: <phase from COMPACT>
- Mode: <mode from COMPACT>
- Role: <agent role, e.g., "AI_OS_OPERATOR_ASSISTANT">
- Truth Sources Loaded: SYSTEM_STATE_COMPACT (v<version>, <timestamp>), GOVERNANCE_LATEST (<timestamp>), EVENT_TIMELINE (last <N> events)

CAPABILITIES:
- Read: Truth Layer, Docs, Code
- Write: PR_CONTRACT_V1 (PR creation via intent + worker)
- Blocked: Direct state edits, live automations (INFRA_ONLY)

HARD CONSTRAINTS:
- INFRA_ONLY: No actions on Or's real Gmail/Calendar/Tasks
- Truth Protocol: Rely only on repo files, not chat memory
- Changes via PR only (using PR_CONTRACT_V1)

CURRENT FOCUS:
- <List 2-3 items from fitness_focus or recent_work>

READY FOR INSTRUCTIONS.
```

**Example Handshake:**
```
ACK_CONTEXT_LOADED

SUMMARY:
- Phase: Phase 2.3 â€“ Stabilizing the Hands (Sync & State Alignment)
- Mode: INFRA_ONLY
- Role: AI_OS_OPERATOR_ASSISTANT
- Truth Sources Loaded: SYSTEM_STATE_COMPACT (v1.2, 2025-11-27T22:40:00Z), GOVERNANCE_LATEST (2025-11-27T20:26:48Z), EVENT_TIMELINE (last 20 events)

CAPABILITIES:
- Read: Truth Layer (COMPACT, GOVERNANCE, TIMELINE), Architecture docs, Code
- Write: PR_CONTRACT_V1 (create PR intents in PR_INTENTS.jsonl, process via pr_worker.py)
- Blocked: Direct edits to state files, Gmail/Calendar/Tasks operations, live automations

HARD CONSTRAINTS:
- INFRA_ONLY: No actions on Or's real-world services (Gmail, Calendar, Tasks, etc.)
- Truth Protocol: All state derived from repo files, not previous chat memory
- All infrastructure changes via PR (using PR_CONTRACT_V1 intent + worker pattern)

CURRENT FOCUS:
- Stabilize Phase 2.3 Control Plane (reconciler, n8n, write contracts)
- Complete Sync Write Contracts (next: Email, Calendar, Tasks)
- Reduce drift between documentation and implementation

RECENT WORK:
- SLICE_STATE_LAYER_RECONCILER_V1 (reconciler.py + COMPACT v1.2)
- SLICE_DAILY_CONTEXT_SYNC_N8N_V1 (n8n workflow with trace_id)
- SLICE_SYNC_WRITE_CONTRACT_PR_V1 (PR intent outbox + worker)

READY FOR INSTRUCTIONS.
```

---

## âœ… Handshake Contract (Response Requirements)

The chat agent **MUST** include these elements in the handshake response:

### Mandatory Fields

1. **`ACK_CONTEXT_LOADED`** - Explicit acknowledgment (first line)
2. **Phase** - Current phase from COMPACT
3. **Mode** - Current mode (INFRA_ONLY, etc.)
4. **Role** - Agent's role (e.g., AI_OS_OPERATOR_ASSISTANT)
5. **Truth Sources Loaded** - List with timestamps
6. **Capabilities** - What agent can read/write
7. **Hard Constraints** - What agent CANNOT do
8. **Current Focus** - What system is working on
9. **`READY FOR INSTRUCTIONS`** - Explicit ready signal (last line)

### Optional Fields

- **Recent Work** - Last 3-5 slices/events
- **Known Issues** - Any errors from TIMELINE
- **Next Steps** - Planned work (if known)

### Format Rules

- **Plain text**, not markdown/JSON
- **Sections with headers** (SUMMARY, CAPABILITIES, etc.)
- **Bullet points** for lists
- **No preamble** - start directly with `ACK_CONTEXT_LOADED`
- **No postamble** - end with `READY FOR INSTRUCTIONS.`

---

## âŒ Failure Modes (Bootstrap Failed)

Bootstrap is considered **FAILED** if:

1. **Missing ACK_CONTEXT_LOADED** - No explicit acknowledgment
2. **Wrong Phase/Mode** - Contradicts COMPACT/GOVERNANCE
3. **Missing Hard Constraints** - Doesn't list INFRA_ONLY or Truth Protocol
4. **Assumes Capabilities** - Claims write access not in contracts (e.g., "I can send emails")
5. **Relies on Memory** - References previous chat context without loading Truth Sources
6. **No Truth Source Timestamps** - Doesn't show which files were loaded

**If Bootstrap Fails:**
- User should prompt: "Please re-run Chat Bootstrap Protocol V1"
- Agent should restart from Step 1

---

## ğŸ“ Examples

### Example 1: Good Handshake

```
ACK_CONTEXT_LOADED

SUMMARY:
- Phase: Phase 2.3 â€“ Stabilizing the Hands (Sync & State Alignment)
- Mode: INFRA_ONLY
- Role: AI_OS_INFRA_OPERATOR
- Truth Sources Loaded: SYSTEM_STATE_COMPACT (v1.2, 2025-11-27T22:40:00Z), GOVERNANCE_LATEST (2025-11-27T20:26:48Z), EVENT_TIMELINE (last 25 events)

CAPABILITIES:
- Read: All Truth Layer files, docs, code
- Write: PR_CONTRACT_V1 only (via PR_INTENTS.jsonl + pr_worker.py)
- Blocked: Direct state edits, live service automations

HARD CONSTRAINTS:
- INFRA_ONLY mode active - no real-world service actions
- Truth Protocol - file-based state only, no chat memory assumptions
- All changes via PR workflow (PR_CONTRACT_V1)

CURRENT FOCUS:
- Completing Sync Write Contracts (Email, Calendar, Tasks)
- Stabilizing Control Plane (reconciler, n8n, contracts)

READY FOR INSTRUCTIONS.
```

**Why This is Good:**
âœ… Starts with `ACK_CONTEXT_LOADED`  
âœ… Includes phase, mode, role  
âœ… Lists truth sources with timestamps  
âœ… Clear capabilities and constraints  
âœ… Ends with `READY FOR INSTRUCTIONS.`

---

### Example 2: Failed Handshake (Missing Constraints)

```
Hi! I've loaded the system state and I'm ready to help.

Current phase: Phase 2.3
Mode: INFRA_ONLY
Services: 10 up, 3 partial

What would you like me to do?
```

**Why This Failed:**
âŒ No `ACK_CONTEXT_LOADED`  
âŒ No hard constraints listed (INFRA_ONLY implications not clear)  
âŒ No truth source timestamps  
âŒ No capabilities list  
âŒ Informal tone (not protocol-compliant)  
âŒ No `READY FOR INSTRUCTIONS.`

**Correct Response:**
User should say: "Please re-run Chat Bootstrap Protocol V1 properly."

---

### Example 3: Failed Handshake (Wrong Assumptions)

```
ACK_CONTEXT_LOADED

I'm ready to help! I can:
- Read all system files
- Send emails via Gmail
- Create calendar events
- Open PRs on GitHub

Current phase: Phase 2.3 (INFRA mode)

What should I work on?
```

**Why This Failed:**
âŒ Claims capabilities not available (send emails, create calendar events)  
âŒ Doesn't list hard constraints (INFRA_ONLY means NO live service actions)  
âŒ No truth source timestamps  
âŒ Missing "READY FOR INSTRUCTIONS."  

**Correct Response:**
User should say: "You've incorrectly claimed email/calendar capabilities. In INFRA_ONLY mode, you can ONLY create PR intents via PR_CONTRACT_V1. Please re-bootstrap."

---

## ğŸ”§ Integration with Existing Docs

This protocol **supersedes** but doesn't replace:

| Old Doc | Status | Relationship |
|---------|--------|--------------|
| `docs/AGENT_INIT_INSTRUCTIONS.md` | Legacy | Reference only - this protocol is simpler and phase-aware |
| `docs/SESSION_INIT_CHECKLIST.md` | Outdated (Phase 2.2) | Replaced by this protocol for Phase 2.3+ |
| `docs/CUSTOM_GPT_OPERATOR_SPEC.md` | Still valid | Complements this (role-specific guidance) |

**Migration Path:**
- Phase 2.3+: Use CHAT_BOOTSTRAP_PROTOCOL_V1
- Phase 2.2 and earlier: Use SESSION_INIT_CHECKLIST (if needed)

---

## ğŸ”® Future Enhancements (V2+)

Planned improvements:

1. **Automated Manifest Generation:**
   - Script: `scripts/generate_session_manifest.py`
   - Output: `docs/session/SESSION_MANIFEST_CURRENT.json`
   - Updated on every reconciler run

2. **Capability Discovery Protocol:**
   - Auto-detect available contracts (PR, Email, Calendar, Tasks)
   - List available tools/MCPs
   - Enumerate allowed operations

3. **Bootstrap Validation:**
   - Script: `scripts/validate_bootstrap_response.py`
   - Validates handshake against protocol
   - Returns: PASS/FAIL + reasons

4. **n8n Integration:**
   - Workflow: `BOOTSTRAP_VALIDATOR_V1`
   - Trigger: On new chat session (webhook?)
   - Validates handshake automatically

5. **Multi-Agent Coordination:**
   - Shared manifest across multiple concurrent chats
   - Session IDs for tracking
   - Conflict detection

---

## ğŸ“Š Success Metrics

Bootstrap is **successful** when:

âœ… Agent produces valid handshake in < 30 seconds  
âœ… Handshake includes all mandatory fields  
âœ… Phase/mode/constraints match Truth Sources  
âœ… Agent doesn't claim unavailable capabilities  
âœ… Agent follows Truth Protocol (no memory assumptions)  

---

**Protocol Version:** 1.0  
**Last Updated:** 2025-11-28  
**Status:** âœ… Active  
**Next Review:** After Phase 2.3 completion
