# AI-OS Governance Layer

**Version:** Bootstrap V1 + State Layer Reconciler V1  
**Created:** 2025-11-27  
**Last Updated:** 2025-11-27  
**Status:** Operational (Reconciler V1)

---

## Purpose

The Governance Layer provides systematic measurement and tracking of AI-OS operational fitness.

This aligns with **CONTROL_PLANE_GOVERNANCE_SPEC_V1** and supports three core fitness metrics:
- **FITNESS_001**: Friction (operational overhead)
- **FITNESS_002**: CCI (Cognitive Capacity Index)
- **FITNESS_003**: Tool Efficacy

---

## State Layer Reconciler V1

**CRITICAL:** `SYSTEM_STATE_COMPACT.json` is a **DERIVED STATE** file, auto-generated by `reconciler_v1`. **DO NOT EDIT MANUALLY.**

### Truth Sources (Priority Order)

1. **`governance/snapshots/GOVERNANCE_LATEST.json`** (authoritative)
   - System state (phase, mode, automations_enabled)
   - Services summary (up, partial, total count)
   - Fitness metrics (FITNESS_001, FITNESS_002)
   - Git metadata (branch, last_commit)

2. **`docs/DECISIONS_AI_OS.md`** (authoritative for decision status)
   - Pending decisions (in_progress, ðŸ“‹)
   - Recent decisions (approved, âœ…)

3. **`docs/system_state/timeline/EVENT_TIMELINE.jsonl`**
   - Recent work (block_complete, SLICE_COMPLETE events)

4. **`docs/system_state/registries/SERVICES_STATUS.json`**
   - Services list

### How to Refresh COMPACT

```bash
cd services/os_core_mcp
python reconciler.py
```

### Drift Types Handled

- Decision status mismatches (e.g., approved in DECISIONS but pending in COMPACT)
- Services count discrepancies
- Timestamp staleness (> 24h)
- Phase/Mode mismatches
- Missing fitness metrics

### Not Auto-Derived Yet

- `open_gaps` - still manual
- Full services array content - only count validated
- Detailed event analysis

**See:** `docs/slices/SLICE_STATE_LAYER_RECONCILER_V1.md` for full details

---

## Directory Structure

```
governance/
â”œâ”€â”€ DEC/              # Decision records (governance-related)
â”œâ”€â”€ EVT/              # Event logs (governance-specific)
â”œâ”€â”€ metrics/          # Computed metrics storage
â”œâ”€â”€ scripts/          # Measurement scripts
â”‚   â”œâ”€â”€ measure_friction.py
â”‚   â”œâ”€â”€ measure_cci.py
â”‚   â”œâ”€â”€ measure_tool_efficacy.py
â”‚   â””â”€â”€ generate_snapshot.py      [OPERATIONAL âœ…]
â””â”€â”€ snapshots/        # Periodic governance snapshots
    â”œâ”€â”€ GOVERNANCE_LATEST.json    [ACTIVE - Truth Source]
    â””â”€â”€ SNAPSHOT_*.json            [Historical snapshots]
```

---

## Scripts

### `generate_snapshot.py` âœ… OPERATIONAL
Generates comprehensive governance snapshot from Truth Layer:
- Reads EVENT_TIMELINE, DECISIONS, SERVICES_STATUS, git metadata
- Calculates FITNESS_001 (Friction) and FITNESS_002 (CCI)
- Saves to `snapshots/SNAPSHOT_<timestamp>.json`
- Updates `snapshots/GOVERNANCE_LATEST.json`

**Status:** Fully implemented (DEC-010)

**Usage:**
```bash
cd governance/scripts
python generate_snapshot.py
```

### `measure_friction.py`
Measures operational friction:
- Tool retries/failures
- Decision latency
- Context switching overhead

**Status:** Stub - implementation pending

### `measure_cci.py`
Measures Cognitive Capacity Index:
- Auto vs manual decisions
- Human-in-the-loop frequency
- Approval patterns

**Status:** Stub - implementation pending

### `measure_tool_efficacy.py`
Measures tool/service effectiveness:
- Success rates
- Retry patterns
- Execution times

**Status:** Stub - implementation pending

---

## Truth Layer Design Principles

1. **GOVERNANCE_LATEST.json** = Single source of truth for system state
2. **SYSTEM_STATE_COMPACT.json** = Derived view (auto-generated, DO NOT EDIT)
3. **EVENT_TIMELINE.jsonl** = Append-only event log
4. **DECISIONS_AI_OS.md** = Authoritative for decision status
5. **Reconciliation** = Automatic drift detection and correction

---

## Next Steps (Post-Reconciler V1)

1. Implement actual measurement logic in stub scripts
2. Define metrics storage format in `metrics/`
3. Set up scheduled snapshot generation (n8n workflow - Phase 2.4+)
4. Add POST /state/refresh endpoint to OS Core MCP
5. Integrate Daily Context Sync with reconciliation
6. Build visualization/reporting layer

---

## Related

- **Spec:** `docs/slices/SLICE_STATE_LAYER_RECONCILER_V1.md`
- **Implementation:** `services/os_core_mcp/reconciler.py`
- **Decision:** DEC-008 (Governance Layer Bootstrap), DEC-010 (Truth Layer Bootstrap)
- **State Layer:** `docs/system_state/` (source of truth)

---

**Note:** Reconciler V1 is operational. COMPACT is now fully derived and should never be edited manually.
